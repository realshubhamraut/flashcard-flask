{% extends "base.html" %}

{% block title %}Statistics{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Your Statistics</h1>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">
            <svg width="48" height="48" viewBox="0 0 16 16" fill="currentColor">
                <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"/>
            </svg>
        </div>
        <div class="stat-info">
            <div class="stat-value">{{ total_decks }}</div>
            <div class="stat-label">Total Decks</div>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <svg width="48" height="48" viewBox="0 0 16 16" fill="currentColor">
                <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>
                <path d="M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8zm0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"/>
            </svg>
        </div>
        <div class="stat-info">
            <div class="stat-value">{{ total_cards }}</div>
            <div class="stat-label">Total Cards</div>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <svg width="48" height="48" viewBox="0 0 16 16" fill="currentColor">
                <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
            </svg>
        </div>
        <div class="stat-info">
            <div class="stat-value">{{ today_reviews }}</div>
            <div class="stat-label">Reviews Today</div>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <svg width="48" height="48" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                <path d="M8 13A5 5 0 1 1 8 3a5 5 0 0 1 0 10zm0 1A6 6 0 1 0 8 2a6 6 0 0 0 0 12z"/>
                <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"/>
                <path d="M9.5 8a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
            </svg>
        </div>
        <div class="stat-info">
            <div class="stat-value">{{ today_accuracy }}%</div>
            <div class="stat-label">Today's Accuracy</div>
        </div>
    </div>
</div>

<div class="time-range-selector">
    <button class="range-btn active" data-days="7">7 Days</button>
    <button class="range-btn" data-days="14">14 Days</button>
    <button class="range-btn" data-days="30">30 Days</button>
    <button class="range-btn" data-days="60">60 Days</button>
    <button class="range-btn" data-days="180">180 Days</button>
</div>

<div class="chart-container">
    <h2>Review History <span id="chart-period">(Last 7 Days)</span></h2>
    <canvas id="reviewChart"></canvas>
</div>

<div class="chart-container">
    <h2>Accuracy Over Time <span id="accuracy-period">(Last 7 Days)</span></h2>
    <canvas id="accuracyChart"></canvas>
</div>

<div class="chart-container">
    <h2>Retention Over Time</h2>
    <p class="chart-description">
        Historical retention rates showing how well you remembered cards on their due dates, 
        with predictions for the next 30 days based on your study patterns.
    </p>
    <canvas id="retentionChart"></canvas>
    <div class="retention-legend">
        <div class="legend-item">
            <span class="legend-color" style="background-color: #4CAF50;"></span>
            <span>Historical Data</span>
        </div>
        <div class="legend-item">
            <span class="legend-color" style="background-color: #2196F3; opacity: 0.5;"></span>
            <span>Predicted Retention</span>
        </div>
    </div>
</div>

<div class="recent-sessions">
    <h2>Recent Study Sessions</h2>
    {% if recent_sessions %}
        <table class="sessions-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Cards Studied</th>
                    <th>Accuracy</th>
                    <th>Duration</th>
                </tr>
            </thead>
            <tbody>
                {% for session in recent_sessions %}
                    <tr>
                        <td>{{ session.started_at|timeago }}</td>
                        <td>{{ session.cards_studied }}</td>
                        <td>
                            <span class="accuracy-badge {% if session.accuracy >= 80 %}accuracy-high{% elif session.accuracy >= 60 %}accuracy-medium{% else %}accuracy-low{% endif %}">
                                {{ session.accuracy }}%
                            </span>
                        </td>
                        <td>
                            {% if session.ended_at %}
                                {{ ((session.ended_at - session.started_at).total_seconds() / 60)|round(1) }} min
                            {% else %}
                                In progress
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="empty-state">
            <p>No study sessions yet. Start studying to see your progress!</p>
        </div>
    {% endif %}
</div>

<script>
    let currentDays = 7; // Default to 7 days
</script>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/stats.js') }}"></script>
{% endblock %}
