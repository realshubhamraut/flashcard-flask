{% extends "base.html" %}

{% block title %}Settings - Flashcard App{% endblock %}

{% block content %}
<div class="page-header">
    <h1>⚙️ Spaced Repetition Settings</h1>
    <p>Customize how the spaced repetition algorithm works for your study sessions</p>
</div>

<div class="settings-container">
    <form method="POST" id="settings-form">
        <div class="settings-section">
            <h2>
                <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" style="vertical-align: middle; margin-right: 8px;">
                    <path d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5v-2zm1 .5v1.308l4.372 4.858A.5.5 0 0 1 7 8.5v5.306l2-.666V8.5a.5.5 0 0 1 .128-.334L13.5 3.308V2h-11z"/>
                </svg>
                Global Interval Multiplier
            </h2>
            <p class="section-description">Adjust all review intervals at once. Higher = longer intervals (easier), Lower = shorter intervals (more reviews)</p>
            
            <div class="form-group">
                <label for="interval_multiplier">
                    Interval Multiplier: <span id="multiplier-value">{{ settings.interval_multiplier }}</span>x
                </label>
                <input type="range" 
                       id="interval_multiplier" 
                       name="interval_multiplier" 
                       min="0.25" 
                       max="3.0" 
                       step="0.05" 
                       value="{{ settings.interval_multiplier }}"
                       class="slider">
                <div class="slider-labels">
                    <span>0.25x (More Reviews)</span>
                    <span>1.0x (Default)</span>
                    <span>3.0x (Fewer Reviews)</span>
                </div>
            </div>
            
            <div class="preview-box">
                <h3>Preview of Intervals</h3>
                <div class="preview-grid">
                    <div class="preview-item">
                        <span class="preview-label">Again:</span>
                        <span id="preview-again">< 10m</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Hard:</span>
                        <span id="preview-hard">12h</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Good:</span>
                        <span id="preview-good">1d</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Easy:</span>
                        <span id="preview-easy">4d</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <h2>
                <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" style="vertical-align: middle; margin-right: 8px;">
                    <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                </svg>
                Base Intervals
            </h2>
            <p class="section-description">Set the default intervals for each rating (before multiplier)</p>
            
            <div class="form-group">
                <label for="again_minutes">Again (minutes)</label>
                <input type="number" id="again_minutes" name="again_minutes" 
                       value="{{ settings.again_minutes }}" min="1" max="60" class="form-control">
                <small>How long before reviewing a card you got wrong</small>
            </div>
            
            <div class="form-group">
                <label for="good_days">Good (days)</label>
                <input type="number" id="good_days" name="good_days" 
                       value="{{ settings.good_days }}" min="1" max="7" step="1" class="form-control">
                <small>Base interval for cards answered correctly</small>
            </div>
            
            <div class="form-group">
                <label for="hard_multiplier">Hard Multiplier</label>
                <input type="number" id="hard_multiplier" name="hard_multiplier" 
                       value="{{ settings.hard_multiplier }}" min="1.0" max="2.0" step="0.1" class="form-control">
                <small>Hard interval = Good × this multiplier</small>
            </div>
            
            <div class="form-group">
                <label for="easy_multiplier">Easy Multiplier</label>
                <input type="number" id="easy_multiplier" name="easy_multiplier" 
                       value="{{ settings.easy_multiplier }}" min="2.0" max="10.0" step="0.5" class="form-control">
                <small>Easy interval = Good × this multiplier</small>
            </div>
        </div>

        <div class="settings-section">
            <h2>
                <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" style="vertical-align: middle; margin-right: 8px;">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                    <path d="M8 13A5 5 0 1 1 8 3a5 5 0 0 1 0 10zm0 1A6 6 0 1 0 8 2a6 6 0 0 0 0 12z"/>
                    <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"/>
                    <path d="M9.5 8a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                </svg>
                Ease Factor Settings
            </h2>
            <p class="section-description">Control how the algorithm adjusts to your performance</p>
            
            <div class="form-group">
                <label for="starting_ease">Starting Ease Factor</label>
                <input type="number" id="starting_ease" name="starting_ease" 
                       value="{{ settings.starting_ease }}" min="1.3" max="5.0" step="0.1" class="form-control">
                <small>Initial ease factor for new cards (default: 2.5)</small>
            </div>
            
            <div class="form-group">
                <label for="easy_bonus">Easy Bonus</label>
                <input type="number" id="easy_bonus" name="easy_bonus" 
                       value="{{ settings.easy_bonus }}" min="1.0" max="2.0" step="0.1" class="form-control">
                <small>Multiplier to ease factor when answering "Easy"</small>
            </div>
            
            <div class="form-group">
                <label for="hard_penalty">Hard Penalty</label>
                <input type="number" id="hard_penalty" name="hard_penalty" 
                       value="{{ settings.hard_penalty }}" min="0.5" max="1.0" step="0.05" class="form-control">
                <small>Multiplier to ease factor when answering "Hard"</small>
            </div>
        </div>

        <div class="settings-section">
            <h2>
                <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" style="vertical-align: middle; margin-right: 8px;">
                    <path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"/>
                </svg>
                Graduating Intervals
            </h2>
            <p class="section-description">Intervals for cards transitioning from "learning" to "review"</p>
            
            <div class="form-group">
                <label for="graduating_interval">Graduating Interval (days)</label>
                <input type="number" id="graduating_interval" name="graduating_interval" 
                       value="{{ settings.graduating_interval }}" min="1" max="7" class="form-control">
                <small>Interval when a card graduates from learning</small>
            </div>
            
            <div class="form-group">
                <label for="easy_interval">Easy Interval (days)</label>
                <input type="number" id="easy_interval" name="easy_interval" 
                       value="{{ settings.easy_interval }}" min="1" max="14" class="form-control">
                <small>Interval when pressing "Easy" on a new card</small>
            </div>
        </div>

        <div class="settings-actions">
            <button type="submit" class="btn btn-primary">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="vertical-align: middle; margin-right: 4px;">
                    <path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1H2z"/>
                </svg>
                Save Settings
            </button>
            <button type="button" class="btn btn-secondary" onclick="resetToDefaults()">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="vertical-align: middle; margin-right: 4px;">
                    <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                    <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                </svg>
                Reset to Defaults
            </button>
            <a href="{{ url_for('index') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
// Real-time preview calculation
const multiplierSlider = document.getElementById('interval_multiplier');
const multiplierValue = document.getElementById('multiplier-value');
const againMinutes = document.getElementById('again_minutes');
const goodDays = document.getElementById('good_days');
const hardMultiplier = document.getElementById('hard_multiplier');
const easyMultiplier = document.getElementById('easy_multiplier');

function updatePreview() {
    const mult = parseFloat(multiplierSlider.value);
    const againMins = parseInt(againMinutes.value);
    const goodDys = parseInt(goodDays.value);
    const hardMult = parseFloat(hardMultiplier.value);
    const easyMult = parseFloat(easyMultiplier.value);
    
    multiplierValue.textContent = mult.toFixed(2);
    
    // Calculate preview intervals
    const againFinal = Math.max(1, Math.round(againMins * mult));
    const goodFinal = Math.max(1, Math.round(goodDys * mult));
    const hardFinal = Math.max(1, Math.round(goodDys * hardMult * mult));
    const easyFinal = Math.max(1, Math.round(goodDys * easyMult * mult));
    
    // Format intervals
    document.getElementById('preview-again').textContent = formatInterval(againFinal, 'minutes');
    document.getElementById('preview-hard').textContent = formatInterval(hardFinal, 'days');
    document.getElementById('preview-good').textContent = formatInterval(goodFinal, 'days');
    document.getElementById('preview-easy').textContent = formatInterval(easyFinal, 'days');
}

function formatInterval(value, unit) {
    if (unit === 'minutes') {
        if (value < 60) return `${value}m`;
        const hours = Math.round(value / 60 * 10) / 10;
        return `${hours}h`;
    } else { // days
        return `${value}d`;
    }
}

function resetToDefaults() {
    if (confirm('Reset all settings to default values?')) {
        document.getElementById('interval_multiplier').value = 1.0;
        document.getElementById('again_minutes').value = 10;
        document.getElementById('hard_multiplier').value = 1.2;
        document.getElementById('good_days').value = 1;
        document.getElementById('easy_multiplier').value = 4.0;
        document.getElementById('starting_ease').value = 2.5;
        document.getElementById('easy_bonus').value = 1.3;
        document.getElementById('hard_penalty').value = 0.8;
        document.getElementById('graduating_interval').value = 1;
        document.getElementById('easy_interval').value = 4;
        updatePreview();
    }
}

// Update preview on any input change
multiplierSlider.addEventListener('input', updatePreview);
againMinutes.addEventListener('input', updatePreview);
goodDays.addEventListener('input', updatePreview);
hardMultiplier.addEventListener('input', updatePreview);
easyMultiplier.addEventListener('input', updatePreview);

// Initial preview
updatePreview();
</script>
{% endblock %}
